{"componentChunkName":"component---src-templates-blog-post-js","path":"/opaque-type/","result":{"data":{"site":{"siteMetadata":{"title":"글감 저장소"}},"markdownRemark":{"id":"bcfb7921-d0ed-572e-bf29-e7448e22a5c5","excerpt":"Opaque Type SwiftUI 를 살펴보던 중 처음 보는 키워드를 발견하게 되었다. 오늘의 주인공인  이 무엇인지 살펴보고자 한다. Swift 공식 문서에 따르면  은  이라는 문법으로 소개되어 있다. A function or method with an opaque return…","html":"<h1>Opaque Type</h1>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">import</span> <span class=\"token class-name\">SwiftUI</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ContentView</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">View</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> body<span class=\"token punctuation\">:</span> <span class=\"token keyword\">some</span> <span class=\"token class-name\">View</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// Some??</span>\n      <span class=\"token class-name\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"Hello World!\"</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>SwiftUI 를 살펴보던 중 처음 보는 키워드를 발견하게 되었다. 오늘의 주인공인 <code class=\"language-text\">some</code> 이 무엇인지 살펴보고자 한다.</p>\n<p><a href=\"https://docs.swift.org/swift-book/LanguageGuide/OpaqueTypes.html\">Swift 공식 문서</a>에 따르면 <code class=\"language-text\">some</code> 은 <code class=\"language-text\">Opaque Type</code> 이라는 문법으로 소개되어 있다.</p>\n<blockquote>\n<p>A function or method with an opaque return type hides its return value’s type information.</p>\n</blockquote>\n<p>머릿말을 해석해보자면 <code class=\"language-text\">Opaque Type</code> 을 반환 타입(return type)으로 사용하는 함수 또는 메소드는 반환 값의 타입 정보를 감출 수 있다고 쓰여있다.</p>\n<p>설명하기에 앞서 문제 상황을 하나 만나보자.</p>\n<h3>베이스 코드</h3>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Point</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Equatable</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> x<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span>\n  <span class=\"token keyword\">var</span> y<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span>\n\n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">func</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>lhs<span class=\"token punctuation\">:</span> <span class=\"token keyword\">Self</span><span class=\"token punctuation\">,</span> rhs<span class=\"token punctuation\">:</span> <span class=\"token keyword\">Self</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> lhs<span class=\"token punctuation\">.</span>x <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>x <span class=\"token operator\">&amp;&amp;</span> lhs<span class=\"token punctuation\">.</span>y <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>y\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function-definition function\">createPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Point</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token class-name\">Point</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> y<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> point1 <span class=\"token operator\">=</span> <span class=\"token function\">createPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> point2 <span class=\"token operator\">=</span> <span class=\"token function\">createPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>point1 <span class=\"token operator\">==</span> point2<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span></code></pre></div>\n<p>예제로 사용할 베이스 코드다. <code class=\"language-text\">Point</code>를 생성해 반환하는 <code class=\"language-text\">createPoint</code> 함수를 만들었다. 이 함수의 헤더 부분을 보면 알 수 있듯이 반환 타입은 <code class=\"language-text\">Point</code> 로 구체 타입을 반환하도록 명시되어 있다.</p>\n<p><code class=\"language-text\">Equable</code> 프로토콜을 채택하고 있어 <code class=\"language-text\">point1</code> 과 <code class=\"language-text\">point2</code> 는 비교 연산을 할 수 있다.</p>\n<h3>코드 확장</h3>\n<p>만약 다른 종류의 Point 를 만드는 경우가 생긴다면 어떻게 해야할까? 예를 들어, 3차원 좌표를 표현하는 좌표를 추가하고 싶은 경우를 생각해볼 수 있다. 프로토콜을 이용해 추상화해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">protocol</span> <span class=\"token class-name\">EquatablePoint</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Equatable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> x<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">var</span> y<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">extension</span> <span class=\"token class-name\">EquatablePoint</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">func</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>lhs<span class=\"token punctuation\">:</span> <span class=\"token keyword\">Self</span><span class=\"token punctuation\">,</span> rhs<span class=\"token punctuation\">:</span> <span class=\"token keyword\">Self</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> lhs<span class=\"token punctuation\">.</span>x <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>x <span class=\"token operator\">&amp;&amp;</span> lhs<span class=\"token punctuation\">.</span>y <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>y\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">Point</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">EquatablePoint</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ThreeDimensionalPoint</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">EquatablePoint</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> x<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span>\n  <span class=\"token keyword\">var</span> y<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span>\n  <span class=\"token keyword\">var</span> z<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">func</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>lhs<span class=\"token punctuation\">:</span> <span class=\"token keyword\">Self</span><span class=\"token punctuation\">,</span> rhs<span class=\"token punctuation\">:</span> <span class=\"token keyword\">Self</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> lhs<span class=\"token punctuation\">.</span>x <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>x <span class=\"token operator\">&amp;&amp;</span> lhs<span class=\"token punctuation\">.</span>y <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>y <span class=\"token operator\">&amp;&amp;</span> lhs<span class=\"token punctuation\">.</span>z <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>z\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">Equatable</code> 를 채택한 <code class=\"language-text\">EquatablePoint</code> 프로토콜을 만들어 한 단계 추상화했고 <code class=\"language-text\">Point</code>, <code class=\"language-text\">ThreeDimensionalPoint</code> 모두 같은 프로토콜을 채택한다. 새로 만든 구조체는 3차원 좌표 표현을 위해 <code class=\"language-text\">z</code> 속성이 추가되었다.</p>\n<p>아, 마지막으로 이제 두 종류의 좌표가 생겼으니 팩토리를 만들어 좌표를 쉽게 만들어보자.</p>\n<h3>문제 상황</h3>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">enum</span> <span class=\"token class-name\">PointFactory</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">createPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span><span class=\"token punctuation\">,</span> z<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">EquatablePoint</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* 🚨 ERROR!\n      Protocol 'EquatablePoint' can only be used as a generic constraint\n      because it has Self or associated type requirements\n    */</span>\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> z <span class=\"token operator\">=</span> z <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token class-name\">ThreeDimensionalPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> y<span class=\"token punctuation\">,</span> z<span class=\"token punctuation\">:</span> z<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">Point</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> y<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>문제가 생겼다. <code class=\"language-text\">Equatable</code> 프로토콜은 <code class=\"language-text\">Self</code> 를 사용해 <code class=\"language-text\">==</code> 메소드의 매개변수 타입을 추론하기 때문에 프로토콜만으로는 해당 타입이 무엇인지 추론할 수 없어 리턴 타입으로 사용할 수 없다는 에러가 발생한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/68526a852cffc3e67a2fdae410dde3a3/6569d/equatable.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.822784810126581%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAnUlEQVQI102MwW7CMBAF8zVtKEkce53NmtiOIOWA4P9/Z1AjRDmMNO8wr3nMV266sYVK1o1a7qzlQbJfOhf5bocP+hf/+6vtaQ/u7c3xxzM74yIr6hJFKkso2HjCxkTvIhITIongTwS/EIIRxHafYuXYeSRkohSawSs2GNd43o+LX8jj8vKMG5VZM7P+xeseTTG9t06VbhBMz5heeAJhY2CiDECiWQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Chinese Salty Egg\"\n        title=\"Chinese Salty Egg\"\n        src=\"/static/68526a852cffc3e67a2fdae410dde3a3/f058b/equatable.png\"\n        srcset=\"/static/68526a852cffc3e67a2fdae410dde3a3/c26ae/equatable.png 158w,\n/static/68526a852cffc3e67a2fdae410dde3a3/6bdcf/equatable.png 315w,\n/static/68526a852cffc3e67a2fdae410dde3a3/f058b/equatable.png 630w,\n/static/68526a852cffc3e67a2fdae410dde3a3/40601/equatable.png 945w,\n/static/68526a852cffc3e67a2fdae410dde3a3/78612/equatable.png 1260w,\n/static/68526a852cffc3e67a2fdae410dde3a3/6569d/equatable.png 1328w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>따라서 프로토콜이 <code class=\"language-text\">associated type</code> 을 가지거나 정의된 메소드의 매개변수, 리턴 타입으로 <code class=\"language-text\">Self</code> 가 사용되면 위의 에러가 발생한다. 에러가 발생했으니 <code class=\"language-text\">Point</code>와 <code class=\"language-text\">ThreeDimensionalPoint</code>를 생성하는 메소드를 각각 만들고 리턴 타입을 구체 타입으로 지정하는 것이 유일한 해결방법일까?</p>\n<p>아니다. 우리에겐 구원투수가 남아있다.</p>\n<h3>Opaque Type comes into play</h3>\n<p>이 글의 머릿말에서 <code class=\"language-text\">Opaque Type</code> 을 반환 타입(return type)으로 사용하는 함수 또는 메소드는 반환 값의 타입 정보를 감출 수 있다고 언급했다.</p>\n<p>여기서 타입 정보를 감춘다는 의미는 본래 구체타입 정보는 그대로 보존한 상태로 외부에는 자신의 타입을 프로토콜로 노출 시킬 수 있다는 의미다. 코드로 살펴보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function-definition function\">createPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">some</span> <span class=\"token class-name\">EquatablePoint</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token class-name\">Point</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> y<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>리턴 타입 앞에 <code class=\"language-text\">Opaque Type</code> 을 의미하는 <code class=\"language-text\">some</code> 을 붙였다. 좀 전에 보았던 에러가 보이지 않은 것을 확인할 수 있다.</p>\n<p>앞전에 <code class=\"language-text\">Equatable</code> 프로토콜은 <code class=\"language-text\">Self</code> 를 사용해 <code class=\"language-text\">==</code> 메소드의 매개변수 타입을 추론하기 때문에 프로토콜만으로는 해당 타입이 무엇인지 추론할 수 없어 리턴 타입으로 사용할 수 없다고 말했다. 그렇다면 지금은 왜 문제가 없다고 하는 걸까?</p>\n<p><code class=\"language-text\">Opaque Type</code> 를 사용하면 <code class=\"language-text\">createPoint</code> 함수의 리턴 값은 사용자인 개발자에게 <code class=\"language-text\">EquatablePoint</code> 로 노출된다. 그러나 컴파일러는 실제 리턴 값이 <code class=\"language-text\">Point</code> 구조체인 것을 알고 있다. 때문에 <code class=\"language-text\">Equatable</code> 프로토콜의 <code class=\"language-text\">Self</code> 가 <code class=\"language-text\">Point</code> 임을 알고 있다는 뜻이다.</p>\n<p>무언가를 감춘다는 의미는 감추는 누군가는 감춘 것이 무엇인지 알고 있다는 의미도 내포한다. 여기서 타입 정보를 감추는 컴파일러는 실제 타입 정보를 알고 있고 컴파일러가 감춘 타입은 개발자는 볼 수 없다.</p>\n<p>실제 함수를 테스트해보면 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> point1 <span class=\"token operator\">=</span> <span class=\"token function\">createPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> point2 <span class=\"token operator\">=</span> <span class=\"token function\">createPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> point3 <span class=\"token operator\">=</span> <span class=\"token function\">createPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>point1 <span class=\"token operator\">==</span> point2<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>point2 <span class=\"token operator\">==</span> point3<span class=\"token punctuation\">)</span> <span class=\"token comment\">// false</span></code></pre></div>\n<p><ins><code class=\"language-text\">Opaque Type</code> 의 장점은 <code class=\"language-text\">Self</code>, <code class=\"language-text\">associated type</code> 을 사용하는 프로토콜을 리턴 타입으로 사용할 수 있게 해준다. 이것의 의미는 해당 프로토콜의 기능을 그대로 사용할 수 있다는 의미다.</ins></p>\n<p>팩토리를 수정해보자.</p>\n<h3>문제 상황.2</h3>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">enum</span> <span class=\"token class-name\">PointFactory</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">createPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span><span class=\"token punctuation\">,</span> z<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">some</span> <span class=\"token class-name\">EquatablePoint</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* 🚨 ERROR!\n      Function declares an opaque return type,\n      but the return statements in its body do not have matching underlying types\n    */</span>\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> z <span class=\"token operator\">=</span> z <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token class-name\">ThreeDimensionalPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> y<span class=\"token punctuation\">,</span> z<span class=\"token punctuation\">:</span> z<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">Point</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> y<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">createPoint</code> 함수의 경우처럼 <code class=\"language-text\">some</code> 추가했는데 에러가 발생했다. 다시 한번 잘 생각해보자.</p>\n<p><code class=\"language-text\">Opaque Type</code> 은 타입 정보를 감출 뿐이지 타입 정보는 그대로 유지시키는 타입이다. 따라서 현재 <code class=\"language-text\">createPoint</code> 메소드는 두 가지 타입을 리턴하는 함수라고 볼 수 있다. Swift 는 강타입 언어이다. 때문에 하나의 함수가 여러 종류의 타입을 리턴할 수 없다. 오직 하나의 타입을 리턴 타입으로 지정할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">enum</span> <span class=\"token class-name\">PointFactory</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">createPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">some</span> <span class=\"token class-name\">EquatablePoint</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">Point</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> y<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">createPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span><span class=\"token punctuation\">,</span> z<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Double</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">some</span> <span class=\"token class-name\">EquatablePoint</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">ThreeDimensionalPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> y<span class=\"token punctuation\">,</span> z<span class=\"token punctuation\">:</span> z<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>함수의 <code class=\"language-text\">Overloading</code> 을 사용해 각각 한 가지 타입을 리턴하는 함수로 분리했다. 비교 연산을 해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">\n<span class=\"token comment\">// 아래 싱수의 타입은 모두 some EquatablePoint 이다.</span>\n<span class=\"token keyword\">let</span> threeDimensionalPoint1 <span class=\"token operator\">=</span> <span class=\"token class-name\">PointFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">createPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> z<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> threeDimensionalPoint2 <span class=\"token operator\">=</span> <span class=\"token class-name\">PointFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">createPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> z<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> threeDimensionalPoint3 <span class=\"token operator\">=</span> <span class=\"token class-name\">PointFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">createPoint</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> z<span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>threeDimensionalPoint1 <span class=\"token operator\">==</span> threeDimensionalPoint2<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>threeDimensionalPoint2 <span class=\"token operator\">==</span> threeDimensionalPoint3<span class=\"token punctuation\">)</span> <span class=\"token comment\">// false</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token comment\">// Point</span>\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">func</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>lhs<span class=\"token punctuation\">:</span> <span class=\"token keyword\">Self</span><span class=\"token punctuation\">,</span> rhs<span class=\"token punctuation\">:</span> <span class=\"token keyword\">Self</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> lhs<span class=\"token punctuation\">.</span>x <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>x <span class=\"token operator\">&amp;&amp;</span> lhs<span class=\"token punctuation\">.</span>y <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>y\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ThreeDimensionalPoint</span>\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">func</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">(</span>lhs<span class=\"token punctuation\">:</span> <span class=\"token keyword\">Self</span><span class=\"token punctuation\">,</span> rhs<span class=\"token punctuation\">:</span> <span class=\"token keyword\">Self</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">Bool</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> lhs<span class=\"token punctuation\">.</span>x <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>x <span class=\"token operator\">&amp;&amp;</span> lhs<span class=\"token punctuation\">.</span>y <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>y <span class=\"token operator\">&amp;&amp;</span> lhs<span class=\"token punctuation\">.</span>z <span class=\"token operator\">==</span> rhs<span class=\"token punctuation\">.</span>z\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이번에는 <code class=\"language-text\">ThreeDimensionalPoint</code> 를 만들어 비교 연산을 해보았다. 그런데 <code class=\"language-text\">Point</code>, <code class=\"language-text\">ThreeDimensionalPoint</code> 구조체 모두 다른 방식으로 <code class=\"language-text\">==</code> 메소드를 구현했다는 사실을 기억해주길 바란다. 서로 다른 구현을 가지고 있지만 컴파일러는 <code class=\"language-text\">Opaque Type</code> 아래 감춰진 구체 타입 정보를 알고 있다. 때문에 감추어진 타입이 가진 메소드를 호출한다.</p>\n<p>따라서 <code class=\"language-text\">ThreeDimensionalPoint</code> 에서 구현된 <code class=\"language-text\">==</code> 메소드를 호출한다.</p>\n<h3>이게 전부인가?</h3>\n<p><code class=\"language-text\">Opaque Type</code> 을 사용하면 제한 되었던 프로토콜의 기능을 사용할 수 있다는 장점이 있다는 건 이해했을 것이다. 그럼 <ins><code class=\"language-text\">Self</code> 나 <code class=\"language-text\">associated type</code> 을 사용하지 않는 프로토콜만 사용할 경우에는 굳이 사용할 필요가 있을까?</ins></p>\n<p>아니다. <code class=\"language-text\">Opaque Type</code> 의 가장 큰 장점을 소개하겠다.</p>\n<h3>Transformation</h3>\n<p><code class=\"language-text\">Opaque Type</code> 을 사용하면 구체 타입은 그대로 보존된다는 사실을 기억해주길 바란다.</p>\n<p>여기서 구체 타입이란 결국 특정 프로토콜을 채택한 타입을 의미한다. 그렇다면 특정 프로토콜을 채택한 타입을 인자로 하는 함수에 전달할 수 있다는 것을 의미한다.</p>\n<p><ins><strong><em>함수의 매개변수 타입을 특정 프로토콜을 채택한 타입으로 지정하는 것과 프로토콜로 지정하는 것에는 큰 차이가 있다.</em></strong></ins></p>\n<p>코드를 살펴보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">protocol</span> <span class=\"token class-name\">Shape</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">String</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">Triangle</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Shape</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">String</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string-literal\"><span class=\"token string\">\"\"\"\n           *\n           **\n           ***\n           \"\"\"</span></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">FlippedShape</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Shape</span><span class=\"token operator\">></span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Shape</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> shape<span class=\"token punctuation\">:</span> <span class=\"token class-name\">T</span>\n  <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">String</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> lines <span class=\"token operator\">=</span> shape<span class=\"token punctuation\">.</span><span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span>separator<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"\\n\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> lines<span class=\"token punctuation\">.</span><span class=\"token function\">reversed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">joined</span><span class=\"token punctuation\">(</span>separator<span class=\"token punctuation\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"\\n\"</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> triangle <span class=\"token operator\">=</span> <span class=\"token class-name\">Triangle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Type is Triangle</span>\n<span class=\"token keyword\">let</span> flippedShape <span class=\"token operator\">=</span> <span class=\"token class-name\">FlippedShape</span><span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">:</span> triangle<span class=\"token punctuation\">)</span> <span class=\"token comment\">// Type is FlippedShape&lt;Triangle></span></code></pre></div>\n<p><code class=\"language-text\">Triangle</code>, <code class=\"language-text\">FlippedShape</code> 모두 Shape 프로토콜을 채택하고 있다.</p>\n<h3>Case.1 매개변수의 타입이 프로토콜인 경우</h3>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function-definition function\">flip</span><span class=\"token punctuation\">(</span><span class=\"token omit keyword\">_</span> shape<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Shape</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">some</span> <span class=\"token class-name\">Shape</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* 🚨 ERROR!\n   Protocol 'Shape' as a type cannot conform to the protocol itself\n  */</span>\n  <span class=\"token keyword\">return</span> <span class=\"token class-name\">FlippedShape</span><span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">:</span> shape<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> triangle <span class=\"token operator\">=</span> <span class=\"token class-name\">Triangle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> flippedTriangle <span class=\"token operator\">=</span> <span class=\"token function\">flip</span><span class=\"token punctuation\">(</span>triangle<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 🚨 ERROR!</span></code></pre></div>\n<p>에러 메시지에 <code class=\"language-text\">Shape as a type</code> 라고 언급된 것처럼 매개변수 shape 은 <code class=\"language-text\">Shape</code> 프로토콜을 채택한 타입을 의미하지 않는다. 즉, Shape 이라는 프로토콜 타입을 매개변수의 타입으로 정했다는 것이다.</p>\n<ul>\n<li>매개변수의 타입을 Int, String, Bool 로 지정하는 것처럼 프로토콜이라는 타입으로 지정했을 뿐이다.</li>\n</ul>\n<p>반면, FlippedShape 구조체의 매개변수는 Shape 프로토콜을 채택한 타입을 매개변수 타입으로 하기 때문에 두 타입이 같지 않다.</p>\n<h3>Case.2 매개변수의 타입이 제너릭인 경우</h3>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function-definition function\">flip</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">Shape</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token omit keyword\">_</span> shape<span class=\"token punctuation\">:</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">some</span> <span class=\"token class-name\">Shape</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token class-name\">FlippedShape</span><span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">:</span> shape<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> triangle <span class=\"token operator\">=</span> <span class=\"token class-name\">Triangle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> flippedTriangle <span class=\"token operator\">=</span> <span class=\"token function\">flip</span><span class=\"token punctuation\">(</span>triangle<span class=\"token punctuation\">)</span> <span class=\"token comment\">// ✅</span>\nflippedTriangle<span class=\"token punctuation\">.</span><span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// ***</span>\n<span class=\"token comment\">// **</span>\n<span class=\"token comment\">// *</span></code></pre></div>\n<p>제너릭을 사용하면 매개변수의 타입을 프로토콜을 채택한 타입으로 정의할 수 있다.</p>\n<h2>TL;DR</h2>\n<ol>\n<li><code class=\"language-text\">Opaque Type</code> 은 함수와 메소드 리턴 값의 타입 정보를 감추지만 본래의 타입 정보를 보존한다.\n<ul>\n<li>클라이언트는 감춰진 타입 정보에 접근할 수 없지만 컴파일러는 접근할 수 있다.</li>\n</ul>\n</li>\n<li><a href=\"https://docs.swift.org/swift-book/LanguageGuide/OpaqueTypes.html#ID614\">구체 타입이 보존되어있기 때문에 <code class=\"language-text\">Self</code>, <code class=\"language-text\">associated type</code> 을 사용하는 프로토콜도 리턴 타입으로 사용할 수 있다.</a></li>\n<li>3 의 경우 타입캐스팅을 하지 않고 해당 프로토콜의 기능을 그대로 사용할 수 있다.</li>\n<li><a href=\"https://docs.swift.org/swift-book/LanguageGuide/OpaqueTypes.html#ID615\">함수의 매개변수 타입이 특정 프로토콜을 채택한 타입인 경우 <code class=\"language-text\">Opaque Type</code> 을 인자로 전달할 수 있다.</a>\n<ul>\n<li>반면, 전달하고자하는 인자의 타입이 프로토콜인 경우에는 전달할 수 없다.</li>\n</ul>\n</li>\n</ol>","frontmatter":{"title":"Opaque Type 이란?","date":"May 08, 2022","description":"Opaque Type 을 반환 타입(return type)으로 사용하는 함수 또는 메소드는 반환 값의 타입 정보를 감출 수 있다고 쓰여있다."}},"previous":{"fields":{"slug":"/new-beginnings/"},"frontmatter":{"title":"New Beginnings"}},"next":null},"pageContext":{"id":"bcfb7921-d0ed-572e-bf29-e7448e22a5c5","previousPostId":"3d0207c0-91da-5ee0-92d9-198256227d25","nextPostId":null}},"staticQueryHashes":["2841359383","3257411868"]}